{"version":3,"file":"fetch.mjs","sources":["../../src/transporters/fetch.ts"],"sourcesContent":["import { type ErrorFunctionType, type RpcTransport } from \"../client\";\r\nimport type { JsonRpcRequest } from \"../types.js\";\r\n\r\nexport type FetchOptions = {\r\n  url: string;\r\n  credentials?: RequestCredentials;\r\n  getHeaders?():\r\n    | Record<string, string>\r\n    | Promise<Record<string, string>>\r\n    | undefined;\r\n  onError?: ErrorFunctionType;\r\n  hasError?(json: any): Parameters<ErrorFunctionType>[0] | undefined;\r\n};\r\n\r\n/**\r\n * Create a RpcTransport that uses the global fetch.\r\n */\r\nexport function fetchTransport(options: FetchOptions): RpcTransport {\r\n  return async (req: JsonRpcRequest, signal: AbortSignal): Promise<any> => {\r\n    const { method, ...request } = req;\r\n    const headers = options?.getHeaders ? await options.getHeaders() : {};\r\n    const res = await fetch(options.url + \"/\" + method, {\r\n      method: \"POST\",\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\",\r\n        ...headers,\r\n      },\r\n      body: JSON.stringify(request),\r\n      credentials: options?.credentials,\r\n      signal,\r\n    });\r\n    if (!res.ok) {\r\n      if (options.onError)\r\n        options.onError({\r\n          code: res.status.toString(),\r\n          message: res.statusText,\r\n        });\r\n      else console.error(res);\r\n    }\r\n    const json = await res.json();\r\n    const error = options.hasError?.(json);\r\n    if (error) {\r\n      if (options.onError) options.onError(error);\r\n      else console.error(res);\r\n    }\r\n    return json;\r\n  };\r\n}\r\n"],"names":[],"mappings":"AAEO,SAAS,cAAc,CAAC,OAAO,EAAE;AACxC,EAAE,OAAO,OAAO,GAAG,EAAE,MAAM,KAAK;AAChC,IAAI,MAAM,EAAE,MAAM,EAAE,GAAG,OAAO,EAAE,GAAG,GAAG,CAAC;AACvC,IAAI,MAAM,OAAO,GAAG,OAAO,EAAE,UAAU,GAAG,MAAM,OAAO,CAAC,UAAU,EAAE,GAAG,EAAE,CAAC;AAC1E,IAAI,MAAM,GAAG,GAAG,MAAM,KAAK,CAAC,OAAO,CAAC,GAAG,GAAG,GAAG,GAAG,MAAM,EAAE;AACxD,MAAM,MAAM,EAAE,MAAM;AACpB,MAAM,OAAO,EAAE;AACf,QAAQ,MAAM,EAAE,kBAAkB;AAClC,QAAQ,cAAc,EAAE,kBAAkB;AAC1C,QAAQ,GAAG,OAAO;AAClB,OAAO;AACP,MAAM,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC;AACnC,MAAM,WAAW,EAAE,OAAO,EAAE,WAAW;AACvC,MAAM,MAAM;AACZ,KAAK,CAAC,CAAC;AACP,IAAI,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE;AACjB,MAAM,IAAI,OAAO,CAAC,OAAO;AACzB,QAAQ,OAAO,CAAC,OAAO,CAAC;AACxB,UAAU,IAAI,EAAE,GAAG,CAAC,MAAM,CAAC,QAAQ,EAAE;AACrC,UAAU,OAAO,EAAE,GAAG,CAAC,UAAU;AACjC,SAAS,CAAC,CAAC;AACX,WAAW,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;AAC9B,KAAK;AACL,IAAI,MAAM,IAAI,GAAG,MAAM,GAAG,CAAC,IAAI,EAAE,CAAC;AAClC,IAAI,MAAM,KAAK,GAAG,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC,CAAC;AAC3C,IAAI,IAAI,KAAK,EAAE;AACf,MAAM,IAAI,OAAO,CAAC,OAAO,EAAE,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;AAClD,WAAW,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;AAC9B,KAAK;AACL,IAAI,OAAO,IAAI,CAAC;AAChB,GAAG,CAAC;AACJ;;;;"}