{"version":3,"file":"post-message.mjs","sources":["../../src/transporters/post-message.ts"],"sourcesContent":["import type { JsonRpcRequest, RpcTransport } from \"../client\";\r\n\r\nexport function postMessageTransport({\r\n  serverWindow,\r\n  clientWindow,\r\n}: {\r\n  serverWindow: Window;\r\n  clientWindow: Window;\r\n}): RpcTransport {\r\n  return async (\r\n    req: JsonRpcRequest,\r\n    signal: AbortSignal,\r\n    onEventCallback?: any\r\n  ): Promise<any> => {\r\n    serverWindow.postMessage(req, \"*\");\r\n\r\n    return new Promise((resolve, reject) => {\r\n      if (onEventCallback && req.method === \"events.on\") {\r\n        const callback = (ev: any) => {\r\n          if (ev.data.id === req.id && ev.data.method) {\r\n            onEventCallback(ev.data);\r\n            // TODO evens.off removeEventListener\r\n            // clientWindow.removeEventListener(\"message\", callback);\r\n          }\r\n        };\r\n        clientWindow.addEventListener(\"message\", callback);\r\n      } else {\r\n        const callback = (ev: MessageEvent<any>) => {\r\n          if (ev.data.id === req.id) {\r\n            resolve(ev.data);\r\n            clientWindow.removeEventListener(\"message\", callback);\r\n          }\r\n        };\r\n        clientWindow.addEventListener(\"message\", callback);\r\n      }\r\n    });\r\n  };\r\n}\r\n"],"names":[],"mappings":"AACO,SAAS,oBAAoB,CAAC;AACrC,EAAE,YAAY;AACd,EAAE,YAAY;AACd,CAAC,EAAE;AACH,EAAE,OAAO,OAAO,GAAG,EAAE,MAAM,EAAE,eAAe,KAAK;AACjD,IAAI,YAAY,CAAC,WAAW,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;AACvC,IAAI,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAK;AAC5C,MAAM,IAAI,eAAe,IAAI,GAAG,CAAC,MAAM,KAAK,WAAW,EAAE;AACzD,QAAQ,MAAM,QAAQ,GAAG,CAAC,EAAE,KAAK;AACjC,UAAU,IAAI,EAAE,CAAC,IAAI,CAAC,EAAE,KAAK,GAAG,CAAC,EAAE,IAAI,EAAE,CAAC,IAAI,CAAC,MAAM,EAAE;AACvD,YAAY,eAAe,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;AACrC,WAAW;AACX,SAAS,CAAC;AACV,QAAQ,YAAY,CAAC,gBAAgB,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;AAC3D,OAAO,MAAM;AACb,QAAQ,MAAM,QAAQ,GAAG,CAAC,EAAE,KAAK;AACjC,UAAU,IAAI,EAAE,CAAC,IAAI,CAAC,EAAE,KAAK,GAAG,CAAC,EAAE,EAAE;AACrC,YAAY,OAAO,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;AAC7B,YAAY,YAAY,CAAC,mBAAmB,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;AAClE,WAAW;AACX,SAAS,CAAC;AACV,QAAQ,YAAY,CAAC,gBAAgB,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;AAC3D,OAAO;AACP,KAAK,CAAC,CAAC;AACP,GAAG,CAAC;AACJ;;;;"}